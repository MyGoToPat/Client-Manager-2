# HiPat - Phase 3: UI/UX Fixes & New Features

## CRITICAL: Build Summary Requirement

**At the end of this build, provide a DETAILED SUMMARY of everything you built, including:**

1. **Files Created** - List every new file with its path and purpose
2. **Files Modified** - List every file you changed and what was changed
3. **Components Built** - List every new React component
4. **Routes Added** - List every new route/page
5. **Types Added** - List every new TypeScript interface/type
6. **Mock Data Added** - List any new mock data
7. **Features Implemented** - Plain English description of each feature
8. **Known Issues** - Any bugs, incomplete features, or things that need attention
9. **Screenshots** - Take screenshots of each major new screen/feature

Format the summary as a markdown document and save it as `BUILD_SUMMARY.md` in the project root.

---

## Overview

This phase fixes redundancies and adds missing features identified in the UI/UX audit.

**Priority Order:**
1. Redesign Dashboard (fix redundancy with Clients)
2. Add Program Templates (enable cohort-based programs)
3. Add Calendar Availability & Booking
4. Fix Analytics (add business metrics)
5. Consolidate Organization/Team

---

## TASK 1: Redesign Dashboard (HIGH PRIORITY)

### Problem
Dashboard and Clients pages show identical content. Dashboard should be an ACTION CENTER.

### New Dashboard Layout

```tsx
// pages/dashboard.tsx - COMPLETE REDESIGN

const Dashboard = () => {
  return (
    <div className="space-y-6">
      {/* Greeting */}
      <div>
        <h1>Good morning, {mentor.name}!</h1>
        <p>Here's what needs your attention today.</p>
      </div>
      
      {/* Priority Cards Row */}
      <div className="grid grid-cols-4 gap-4">
        <PriorityCard 
          title="Needs Attention" 
          count={needsAttention.length}
          subtitle="Compliance dropped"
          icon={AlertTriangle}
          variant="warning"
        />
        <PriorityCard 
          title="Unread Messages" 
          count={unreadMessages}
          subtitle="Respond to clients"
          icon={MessageSquare}
        />
        <PriorityCard 
          title="Today's Sessions" 
          count={todaysSessions.length}
          subtitle="Scheduled today"
          icon={Calendar}
        />
        <PriorityCard 
          title="Due Soon" 
          count={dueSoon.length}
          subtitle="Programs ending"
          icon={Clock}
        />
      </div>
      
      {/* Needs Attention Section */}
      <NeedsAttentionSection clients={needsAttention} />
      
      {/* Today's Sessions */}
      <TodaysSessionsSection sessions={todaysSessions} />
      
      {/* Recent Activity Feed */}
      <ActivityFeedSection activities={recentActivity} />
      
      {/* Business Snapshot */}
      <BusinessSnapshotSection stats={businessStats} />
    </div>
  );
};
```

### New Components to Create

```
components/dashboard/
â”œâ”€â”€ priority-card.tsx           # Metric card with icon and count
â”œâ”€â”€ needs-attention-section.tsx # Clients with compliance drop
â”œâ”€â”€ todays-sessions-section.tsx # Sessions scheduled for today
â”œâ”€â”€ activity-feed-section.tsx   # Recent client activity
â””â”€â”€ business-snapshot-section.tsx # Revenue, churn, etc.
```

### Types to Add

```typescript
// types/index.ts

export interface ClientActivity {
  id: string;
  clientId: string;
  clientName: string;
  type: 'workout_completed' | 'message_sent' | 'meal_logged' | 'streak_milestone' | 'check_in' | 'joined_group';
  description: string;
  timestamp: Date;
  metadata?: Record<string, any>;
}

export interface BusinessStats {
  mrr: number;
  mrrChange: number;
  newClients: number;
  churnedClients: number;
  avgCompliance: number;
  complianceChange: number;
  revenuePerClient: number;
}

export interface NeedsAttentionClient {
  client: Client;
  complianceDrop: number; // percentage points dropped
  previousCompliance: number;
  currentCompliance: number;
  daysSinceActive: number;
  reason: string;
}
```

### Mock Data to Add

```typescript
// mocks/dashboard.mock.ts

export const mockRecentActivity: ClientActivity[] = [
  {
    id: 'act-1',
    clientId: 'client-1',
    clientName: 'Sarah Johnson',
    type: 'workout_completed',
    description: 'Completed "Upper Body Strength"',
    timestamp: new Date(Date.now() - 2 * 60 * 60 * 1000), // 2h ago
  },
  {
    id: 'act-2',
    clientId: 'client-2',
    clientName: 'Michael Chen',
    type: 'meal_logged',
    description: 'Logged 3,200 calories',
    timestamp: new Date(Date.now() - 3 * 60 * 60 * 1000),
  },
  {
    id: 'act-3',
    clientId: 'client-2',
    clientName: 'Michael Chen',
    type: 'message_sent',
    description: 'Sent you a message: "Hey coach, quick question..."',
    timestamp: new Date(Date.now() - 4 * 60 * 60 * 1000),
  },
  {
    id: 'act-4',
    clientId: 'client-5',
    clientName: 'Lisa Park',
    type: 'streak_milestone',
    description: 'Hit a 30-day workout streak! ðŸ”¥',
    timestamp: new Date(Date.now() - 5 * 60 * 60 * 1000),
  },
];

export const mockNeedsAttention: NeedsAttentionClient[] = [
  {
    client: mockClients[2], // Emily Rodriguez
    complianceDrop: 45,
    previousCompliance: 68,
    currentCompliance: 23,
    daysSinceActive: 7,
    reason: 'No workouts logged for 7 days',
  },
  {
    client: mockClients[5], // James Wilson
    complianceDrop: 30,
    previousCompliance: 45,
    currentCompliance: 15,
    daysSinceActive: 5,
    reason: 'Account suspended, may need follow-up',
  },
];

export const mockBusinessStats: BusinessStats = {
  mrr: 4250,
  mrrChange: 12,
  newClients: 3,
  churnedClients: 1,
  avgCompliance: 78,
  complianceChange: 5,
  revenuePerClient: 708,
};
```

### Update Clients Page

The `/clients` page should now be a detailed management view:
- Keep the client list but add:
  - Bulk select checkboxes
  - Bulk actions dropdown (Message All, Assign to Group, Export)
  - Advanced filters (by group, compliance range, status)
  - Sort options
  - Export to CSV button

---

## TASK 2: Program Templates (HIGH PRIORITY)

### Purpose
Allow mentors to create reusable program structures with content and directives that can be applied to groups.

### New Types

```typescript
// types/index.ts

export interface ProgramTemplate {
  id: string;
  mentorId: string;
  
  // Basic Info
  name: string;
  description: string;
  coverImage?: string;
  
  // Structure
  durationWeeks: number;
  
  // Content
  modules: ProgramModule[];
  
  // Directives (week-relative)
  directives: TemplateDirective[];
  
  // Settings
  requireSequentialCompletion: boolean;
  allowSelfEnroll: boolean;
  price?: number;
  
  // Stats
  timesUsed: number;
  avgCompletionRate: number;
  
  isActive: boolean;
  createdAt: Date;
  updatedAt: Date;
}

export interface ProgramModule {
  id: string;
  week: number;
  day?: number; // 1-7, optional
  title: string;
  description?: string;
  type: 'video' | 'pdf' | 'workout' | 'quiz' | 'checkin' | 'text';
  content: {
    url?: string;
    videoUrl?: string;
    pdfUrl?: string;
    workoutId?: string;
    textContent?: string;
    questions?: QuizQuestion[];
  };
  requiresCompletion: boolean;
  estimatedMinutes?: number;
}

export interface QuizQuestion {
  id: string;
  question: string;
  type: 'multiple_choice' | 'text' | 'scale';
  options?: string[];
  correctAnswer?: string;
}

export interface TemplateDirective {
  id: string;
  week: number;
  day?: number;
  name: string;
  description: string;
  directiveType: string;
  action: DirectiveAction;
  delivery: {
    tone: string;
    format: string;
  };
}
```

### New Pages

```
pages/
â”œâ”€â”€ program-templates.tsx        # List all templates
â””â”€â”€ program-template-builder.tsx # Create/edit template
```

### Program Templates List Page

```tsx
// pages/program-templates.tsx

const ProgramTemplates = () => {
  return (
    <div className="space-y-6">
      <div className="flex justify-between items-center">
        <h1>Program Templates</h1>
        <Button onClick={() => navigate('/program-templates/new')}>
          <Plus className="w-4 h-4 mr-2" />
          Create Template
        </Button>
      </div>
      
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        {templates.map(template => (
          <ProgramTemplateCard 
            key={template.id}
            template={template}
            onEdit={() => navigate(`/program-templates/${template.id}`)}
            onCreateGroup={() => openCreateGroupModal(template)}
          />
        ))}
      </div>
    </div>
  );
};
```

### Program Template Builder

```tsx
// pages/program-template-builder.tsx

const ProgramTemplateBuilder = () => {
  const [template, setTemplate] = useState<Partial<ProgramTemplate>>({
    name: '',
    description: '',
    durationWeeks: 12,
    modules: [],
    directives: [],
    requireSequentialCompletion: true,
  });
  
  return (
    <div className="space-y-6">
      <div className="flex justify-between">
        <h1>{isEditing ? 'Edit Template' : 'Create Program Template'}</h1>
        <Button onClick={handleSave}>Save Template</Button>
      </div>
      
      {/* Basic Info Section */}
      <Card>
        <CardHeader>
          <CardTitle>Basic Information</CardTitle>
        </CardHeader>
        <CardContent className="space-y-4">
          <div>
            <Label>Program Name *</Label>
            <Input 
              value={template.name}
              onChange={(e) => setTemplate({...template, name: e.target.value})}
              placeholder="e.g., 12-Week Shred"
            />
          </div>
          <div>
            <Label>Duration *</Label>
            <Select 
              value={template.durationWeeks?.toString()}
              onValueChange={(v) => setTemplate({...template, durationWeeks: parseInt(v)})}
            >
              {[4, 6, 8, 10, 12, 16, 20, 24].map(w => (
                <SelectItem key={w} value={w.toString()}>{w} weeks</SelectItem>
              ))}
            </Select>
          </div>
          <div>
            <Label>Description</Label>
            <Textarea 
              value={template.description}
              onChange={(e) => setTemplate({...template, description: e.target.value})}
              placeholder="Describe what this program is about..."
            />
          </div>
        </CardContent>
      </Card>
      
      {/* Weekly Content Section */}
      <Card>
        <CardHeader>
          <CardTitle>Weekly Content</CardTitle>
          <CardDescription>
            Add videos, PDFs, workouts, and check-ins for each week
          </CardDescription>
        </CardHeader>
        <CardContent>
          {Array.from({ length: template.durationWeeks || 12 }).map((_, weekIndex) => (
            <WeekContentEditor
              key={weekIndex}
              week={weekIndex + 1}
              modules={template.modules?.filter(m => m.week === weekIndex + 1) || []}
              onAddModule={(module) => addModule(weekIndex + 1, module)}
              onRemoveModule={(moduleId) => removeModule(moduleId)}
            />
          ))}
        </CardContent>
      </Card>
      
      {/* Automated Directives Section */}
      <Card>
        <CardHeader>
          <CardTitle>Automated Directives</CardTitle>
          <CardDescription>
            Set up Pat to automatically send messages at specific points in the program
          </CardDescription>
        </CardHeader>
        <CardContent>
          <div className="space-y-4">
            {template.directives?.map(directive => (
              <TemplateDirectiveCard 
                key={directive.id}
                directive={directive}
                onEdit={() => editDirective(directive)}
                onDelete={() => deleteDirective(directive.id)}
              />
            ))}
            <Button variant="outline" onClick={() => setShowAddDirective(true)}>
              <Plus className="w-4 h-4 mr-2" />
              Add Directive
            </Button>
          </div>
        </CardContent>
      </Card>
      
      {/* Settings Section */}
      <Card>
        <CardHeader>
          <CardTitle>Settings</CardTitle>
        </CardHeader>
        <CardContent className="space-y-4">
          <div className="flex items-center space-x-2">
            <Checkbox 
              checked={template.requireSequentialCompletion}
              onCheckedChange={(checked) => 
                setTemplate({...template, requireSequentialCompletion: checked as boolean})
              }
            />
            <Label>Require sequential completion (can't skip ahead)</Label>
          </div>
          <div className="flex items-center space-x-2">
            <Checkbox 
              checked={template.allowSelfEnroll}
              onCheckedChange={(checked) => 
                setTemplate({...template, allowSelfEnroll: checked as boolean})
              }
            />
            <Label>Allow clients to purchase directly</Label>
          </div>
          {template.allowSelfEnroll && (
            <div>
              <Label>Price ($)</Label>
              <Input 
                type="number"
                value={template.price || ''}
                onChange={(e) => setTemplate({...template, price: parseFloat(e.target.value)})}
                placeholder="297"
              />
            </div>
          )}
        </CardContent>
      </Card>
    </div>
  );
};
```

### Components to Create

```
components/program-templates/
â”œâ”€â”€ program-template-card.tsx      # Card in list view
â”œâ”€â”€ week-content-editor.tsx        # Edit modules for a week
â”œâ”€â”€ module-card.tsx                # Individual module display
â”œâ”€â”€ add-module-modal.tsx           # Modal to add new module
â”œâ”€â”€ template-directive-card.tsx    # Directive in template
â”œâ”€â”€ add-template-directive-modal.tsx
â””â”€â”€ create-group-from-template-modal.tsx
```

### Mock Data

```typescript
// mocks/program-templates.mock.ts

export const mockProgramTemplates: ProgramTemplate[] = [
  {
    id: 'template-1',
    mentorId: 'mentor-1',
    name: '12-Week Shred',
    description: '12-week transformation program focusing on fat loss and muscle definition. Includes nutrition guidance and 4 workouts per week.',
    durationWeeks: 12,
    modules: [
      {
        id: 'mod-1',
        week: 1,
        day: 1,
        title: 'Welcome Video',
        type: 'video',
        content: { videoUrl: 'https://example.com/welcome.mp4' },
        requiresCompletion: true,
        estimatedMinutes: 10,
      },
      {
        id: 'mod-2',
        week: 1,
        day: 1,
        title: 'Program Guide',
        type: 'pdf',
        content: { pdfUrl: 'https://example.com/guide.pdf' },
        requiresCompletion: true,
        estimatedMinutes: 15,
      },
      {
        id: 'mod-3',
        week: 1,
        day: 2,
        title: 'Assessment Workout',
        type: 'workout',
        content: { workoutId: 'workout-assessment' },
        requiresCompletion: true,
        estimatedMinutes: 45,
      },
      {
        id: 'mod-4',
        week: 1,
        day: 7,
        title: 'Week 1 Check-in',
        type: 'checkin',
        content: {
          questions: [
            { id: 'q1', question: 'How are you feeling after week 1?', type: 'scale' },
            { id: 'q2', question: 'Any challenges so far?', type: 'text' },
          ]
        },
        requiresCompletion: true,
        estimatedMinutes: 5,
      },
    ],
    directives: [
      {
        id: 'dir-1',
        week: 1,
        day: 1,
        name: 'Welcome Message',
        description: 'Welcome new member to the program',
        directiveType: 'encouragement',
        action: { actionType: 'deliver_message' },
        delivery: { tone: 'encouraging', format: 'detailed' },
      },
      {
        id: 'dir-2',
        week: 4,
        day: 1,
        name: '1/3 Done Motivation',
        description: 'Celebrate 1/3 completion milestone',
        directiveType: 'encouragement',
        action: { actionType: 'encourage' },
        delivery: { tone: 'celebratory', format: 'brief' },
      },
      {
        id: 'dir-3',
        week: 8,
        day: 1,
        name: 'Progress Photo Reminder',
        description: 'Remind to take progress photos',
        directiveType: 'reminder',
        action: { actionType: 'remind' },
        delivery: { tone: 'encouraging', format: 'brief' },
      },
      {
        id: 'dir-4',
        week: 12,
        day: 7,
        name: 'Program Complete Celebration',
        description: 'Celebrate completion and discuss next steps',
        directiveType: 'encouragement',
        action: { actionType: 'encourage' },
        delivery: { tone: 'celebratory', format: 'detailed' },
      },
    ],
    requireSequentialCompletion: true,
    allowSelfEnroll: false,
    timesUsed: 3,
    avgCompletionRate: 85,
    isActive: true,
    createdAt: new Date('2024-10-01'),
    updatedAt: new Date('2024-12-15'),
  },
  {
    id: 'template-2',
    mentorId: 'mentor-1',
    name: '8-Week Nutrition Reset',
    description: 'Focus on building healthy eating habits with weekly meal plans and nutrition education.',
    durationWeeks: 8,
    modules: [],
    directives: [],
    requireSequentialCompletion: true,
    allowSelfEnroll: true,
    price: 197,
    timesUsed: 1,
    avgCompletionRate: 70,
    isActive: true,
    createdAt: new Date('2024-11-15'),
    updatedAt: new Date('2024-12-10'),
  },
];
```

### Update Groups

When creating a group from a template, the group should:
1. Copy all modules into the group
2. Copy all directives (adjusted to be relative to group start date)
3. Set the program info (name, duration, start date)

Add to Create Group Modal:
```tsx
// If creating from template
{fromTemplate && (
  <Alert>
    <Info className="h-4 w-4" />
    <AlertDescription>
      This group will include all content and directives from "{template.name}".
      Directives will trigger relative to each member's start date.
    </AlertDescription>
  </Alert>
)}
```

### Routes to Add

```tsx
// App.tsx
<Route path="/program-templates" element={<ProgramTemplates />} />
<Route path="/program-templates/new" element={<ProgramTemplateBuilder />} />
<Route path="/program-templates/:id" element={<ProgramTemplateBuilder />} />
```

### Sidebar Update

Add "Program Templates" to sidebar under Groups:
```tsx
{
  title: "Program Templates",
  url: "/program-templates",
  icon: BookOpen,
}
```

---

## TASK 3: Calendar Availability & Booking

### New Types

```typescript
// types/index.ts

export interface Availability {
  id: string;
  mentorId: string;
  dayOfWeek: 0 | 1 | 2 | 3 | 4 | 5 | 6; // 0 = Sunday
  startTime: string; // "09:00"
  endTime: string;   // "12:00"
  isActive: boolean;
}

export interface BookingSettings {
  mentorId: string;
  defaultSessionLength: number; // minutes
  bufferBetweenSessions: number; // minutes
  minimumNotice: number; // hours
  maximumAdvanceBooking: number; // days
  defaultMeetingType: 'in_person' | 'zoom' | 'google_meet';
  zoomConnected: boolean;
  googleMeetConnected: boolean;
  autoGenerateMeetingLink: boolean;
  sendReminder24h: boolean;
  sendReminder1h: boolean;
}

export interface Booking {
  id: string;
  mentorId: string;
  clientId: string;
  clientName: string;
  date: Date;
  startTime: string;
  endTime: string;
  sessionType: string;
  meetingType: 'in_person' | 'zoom' | 'google_meet';
  meetingLink?: string;
  status: 'scheduled' | 'completed' | 'cancelled' | 'no_show';
  notes?: string;
  createdAt: Date;
}

export interface BlockedTime {
  id: string;
  mentorId: string;
  date: Date;
  startTime?: string;
  endTime?: string;
  allDay: boolean;
  reason?: string; // "Holiday", "Vacation", etc.
}
```

### New Components

```
components/calendar/
â”œâ”€â”€ availability-modal.tsx     # Set recurring availability
â”œâ”€â”€ booking-settings-modal.tsx # Session length, buffer, etc.
â”œâ”€â”€ add-booking-modal.tsx      # Manually add a session
â”œâ”€â”€ booking-card.tsx           # Display a booking on calendar
â”œâ”€â”€ availability-slot.tsx      # Display available slot
â””â”€â”€ block-time-modal.tsx       # Block off dates
```

### Updated Calendar Page

```tsx
// pages/calendar.tsx

const Calendar = () => {
  const [showAvailabilityModal, setShowAvailabilityModal] = useState(false);
  const [showAddBookingModal, setShowAddBookingModal] = useState(false);
  
  return (
    <div className="space-y-6">
      <div className="flex justify-between items-center">
        <h1>Calendar</h1>
        <div className="flex gap-2">
          <Button variant="outline" onClick={() => setShowAvailabilityModal(true)}>
            <Clock className="w-4 h-4 mr-2" />
            Set Availability
          </Button>
          <Button onClick={() => setShowAddBookingModal(true)}>
            <Plus className="w-4 h-4 mr-2" />
            Add Session
          </Button>
        </div>
      </div>
      
      {/* Calendar Grid */}
      <CalendarGrid 
        bookings={bookings}
        availability={availability}
        blockedTimes={blockedTimes}
        onSlotClick={(slot) => handleSlotClick(slot)}
        onBookingClick={(booking) => handleBookingClick(booking)}
      />
      
      {/* Legend */}
      <div className="flex gap-4 text-sm">
        <div className="flex items-center gap-2">
          <div className="w-3 h-3 rounded bg-green-500" />
          <span>Available</span>
        </div>
        <div className="flex items-center gap-2">
          <div className="w-3 h-3 rounded bg-blue-500" />
          <span>Booked</span>
        </div>
        <div className="flex items-center gap-2">
          <div className="w-3 h-3 rounded bg-yellow-500" />
          <span>Pending</span>
        </div>
        <div className="flex items-center gap-2">
          <div className="w-3 h-3 rounded bg-red-500" />
          <span>Cancelled</span>
        </div>
        <div className="flex items-center gap-2">
          <div className="w-3 h-3 rounded bg-gray-500" />
          <span>Blocked</span>
        </div>
      </div>
      
      {/* Modals */}
      <AvailabilityModal 
        open={showAvailabilityModal}
        onClose={() => setShowAvailabilityModal(false)}
        availability={availability}
        settings={bookingSettings}
        onSave={handleSaveAvailability}
      />
      
      <AddBookingModal
        open={showAddBookingModal}
        onClose={() => setShowAddBookingModal(false)}
        onSave={handleAddBooking}
      />
    </div>
  );
};
```

### Availability Modal

```tsx
// components/calendar/availability-modal.tsx

const AvailabilityModal = ({ open, onClose, availability, settings, onSave }) => {
  const daysOfWeek = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
  
  return (
    <Dialog open={open} onOpenChange={onClose}>
      <DialogContent className="max-w-2xl max-h-[90vh] overflow-y-auto">
        <DialogHeader>
          <DialogTitle>Set Your Availability</DialogTitle>
        </DialogHeader>
        
        <div className="space-y-6">
          {/* Recurring Availability */}
          <div>
            <h3 className="font-semibold mb-4">Recurring Availability</h3>
            {daysOfWeek.map((day, index) => (
              <DayAvailabilityRow
                key={day}
                day={day}
                dayIndex={index}
                slots={availability.filter(a => a.dayOfWeek === index)}
                onToggle={(enabled) => handleDayToggle(index, enabled)}
                onAddSlot={() => handleAddSlot(index)}
                onRemoveSlot={(slotId) => handleRemoveSlot(slotId)}
                onUpdateSlot={(slotId, field, value) => handleUpdateSlot(slotId, field, value)}
              />
            ))}
          </div>
          
          {/* Session Settings */}
          <div>
            <h3 className="font-semibold mb-4">Session Settings</h3>
            <div className="grid grid-cols-2 gap-4">
              <div>
                <Label>Default session length</Label>
                <Select value={settings.defaultSessionLength.toString()}>
                  <SelectItem value="30">30 minutes</SelectItem>
                  <SelectItem value="45">45 minutes</SelectItem>
                  <SelectItem value="60">60 minutes</SelectItem>
                  <SelectItem value="90">90 minutes</SelectItem>
                </Select>
              </div>
              <div>
                <Label>Buffer between sessions</Label>
                <Select value={settings.bufferBetweenSessions.toString()}>
                  <SelectItem value="0">No buffer</SelectItem>
                  <SelectItem value="15">15 minutes</SelectItem>
                  <SelectItem value="30">30 minutes</SelectItem>
                </Select>
              </div>
              <div>
                <Label>Minimum notice to book</Label>
                <Select value={settings.minimumNotice.toString()}>
                  <SelectItem value="1">1 hour</SelectItem>
                  <SelectItem value="2">2 hours</SelectItem>
                  <SelectItem value="24">24 hours</SelectItem>
                  <SelectItem value="48">48 hours</SelectItem>
                </Select>
              </div>
              <div>
                <Label>Maximum advance booking</Label>
                <Select value={settings.maximumAdvanceBooking.toString()}>
                  <SelectItem value="7">1 week</SelectItem>
                  <SelectItem value="14">2 weeks</SelectItem>
                  <SelectItem value="30">1 month</SelectItem>
                  <SelectItem value="60">2 months</SelectItem>
                </Select>
              </div>
            </div>
          </div>
          
          {/* Video Call Integration */}
          <div>
            <h3 className="font-semibold mb-4">Video Call Integration</h3>
            <div className="space-y-4">
              <div>
                <Label>Default meeting type</Label>
                <RadioGroup value={settings.defaultMeetingType}>
                  <div className="flex items-center space-x-2">
                    <RadioGroupItem value="in_person" id="in_person" />
                    <Label htmlFor="in_person">In-Person</Label>
                  </div>
                  <div className="flex items-center space-x-2">
                    <RadioGroupItem value="zoom" id="zoom" />
                    <Label htmlFor="zoom">Zoom</Label>
                  </div>
                  <div className="flex items-center space-x-2">
                    <RadioGroupItem value="google_meet" id="google_meet" />
                    <Label htmlFor="google_meet">Google Meet</Label>
                  </div>
                </RadioGroup>
              </div>
              
              <div className="flex items-center justify-between p-3 border rounded-lg">
                <div className="flex items-center gap-2">
                  <Video className="w-5 h-5" />
                  <span>Zoom</span>
                </div>
                {settings.zoomConnected ? (
                  <Badge variant="success">Connected</Badge>
                ) : (
                  <Button variant="outline" size="sm">Connect</Button>
                )}
              </div>
              
              <div className="flex items-center justify-between p-3 border rounded-lg">
                <div className="flex items-center gap-2">
                  <Video className="w-5 h-5" />
                  <span>Google Meet</span>
                </div>
                {settings.googleMeetConnected ? (
                  <Badge variant="success">Connected</Badge>
                ) : (
                  <Button variant="outline" size="sm">Connect</Button>
                )}
              </div>
              
              <div className="space-y-2">
                <div className="flex items-center space-x-2">
                  <Checkbox 
                    checked={settings.autoGenerateMeetingLink}
                    id="auto-link"
                  />
                  <Label htmlFor="auto-link">Auto-generate meeting link for remote sessions</Label>
                </div>
                <div className="flex items-center space-x-2">
                  <Checkbox 
                    checked={settings.sendReminder24h}
                    id="remind-24"
                  />
                  <Label htmlFor="remind-24">Send reminder 24 hours before</Label>
                </div>
                <div className="flex items-center space-x-2">
                  <Checkbox 
                    checked={settings.sendReminder1h}
                    id="remind-1"
                  />
                  <Label htmlFor="remind-1">Send reminder 1 hour before</Label>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <DialogFooter>
          <Button variant="outline" onClick={onClose}>Cancel</Button>
          <Button onClick={handleSave}>Save Availability</Button>
        </DialogFooter>
      </DialogContent>
    </Dialog>
  );
};
```

### Mock Data

```typescript
// mocks/calendar.mock.ts

export const mockAvailability: Availability[] = [
  { id: 'avail-1', mentorId: 'mentor-1', dayOfWeek: 1, startTime: '09:00', endTime: '12:00', isActive: true },
  { id: 'avail-2', mentorId: 'mentor-1', dayOfWeek: 1, startTime: '17:00', endTime: '20:00', isActive: true },
  { id: 'avail-3', mentorId: 'mentor-1', dayOfWeek: 2, startTime: '09:00', endTime: '12:00', isActive: true },
  { id: 'avail-4', mentorId: 'mentor-1', dayOfWeek: 4, startTime: '09:00', endTime: '12:00', isActive: true },
  { id: 'avail-5', mentorId: 'mentor-1', dayOfWeek: 5, startTime: '09:00', endTime: '12:00', isActive: true },
];

export const mockBookingSettings: BookingSettings = {
  mentorId: 'mentor-1',
  defaultSessionLength: 60,
  bufferBetweenSessions: 15,
  minimumNotice: 24,
  maximumAdvanceBooking: 14,
  defaultMeetingType: 'zoom',
  zoomConnected: true,
  googleMeetConnected: false,
  autoGenerateMeetingLink: true,
  sendReminder24h: true,
  sendReminder1h: true,
};

export const mockBookings: Booking[] = [
  {
    id: 'booking-1',
    mentorId: 'mentor-1',
    clientId: 'client-1',
    clientName: 'Sarah Johnson',
    date: new Date(),
    startTime: '17:52',
    endTime: '18:52',
    sessionType: '1:1 Training',
    meetingType: 'in_person',
    status: 'scheduled',
    createdAt: new Date(),
  },
  {
    id: 'booking-2',
    mentorId: 'mentor-1',
    clientId: 'client-2',
    clientName: 'Michael Chen',
    date: new Date(Date.now() + 86400000), // Tomorrow
    startTime: '17:52',
    endTime: '18:52',
    sessionType: '1:1 Training',
    meetingType: 'zoom',
    meetingLink: 'https://zoom.us/j/123456789',
    status: 'scheduled',
    createdAt: new Date(),
  },
];
```

---

## TASK 4: Fix Analytics

### Update Types

```typescript
// Add to types/index.ts

export interface AnalyticsData {
  // Revenue
  mrr: number;
  mrrChange: number;
  revenueByMonth: { month: string; revenue: number }[];
  revenueBySource: { source: string; amount: number; percentage: number }[];
  
  // Clients
  totalClients: number;
  activeClients: number;
  newClientsThisMonth: number;
  churnedClientsThisMonth: number;
  churnRate: number;
  retentionRate: number;
  avgClientLifespan: number; // months
  revenuePerClient: number;
  ltv: number; // lifetime value
  
  // Engagement
  avgCompliance: number;
  complianceChange: number;
  sessionsCompleted: number;
  directivesTriggered: number;
  avgDirectiveEffectiveness: number;
  
  // By Group
  complianceByGroup: { groupName: string; compliance: number }[];
  
  // Retention Cohort
  retentionCohort: { month: string; retained: number }[];
  
  // Top/At Risk
  topClientsByLtv: { client: Client; ltv: number }[];
  atRiskClients: { client: Client; compliance: number }[];
}
```

### Updated Analytics Page

```tsx
// pages/analytics.tsx

const Analytics = () => {
  const [timeRange, setTimeRange] = useState('this_month');
  const [activeTab, setActiveTab] = useState('revenue');
  
  return (
    <div className="space-y-6">
      <div className="flex justify-between items-center">
        <h1>Analytics</h1>
        <div className="flex gap-2">
          <Select value={timeRange} onValueChange={setTimeRange}>
            <SelectItem value="this_week">This Week</SelectItem>
            <SelectItem value="this_month">This Month</SelectItem>
            <SelectItem value="last_month">Last Month</SelectItem>
            <SelectItem value="this_quarter">This Quarter</SelectItem>
            <SelectItem value="this_year">This Year</SelectItem>
          </Select>
          <Button variant="outline">
            <Download className="w-4 h-4 mr-2" />
            Export
          </Button>
        </div>
      </div>
      
      {/* Top Metrics */}
      <div className="grid grid-cols-5 gap-4">
        <MetricCard
          title="MRR"
          value={`$${data.mrr.toLocaleString()}`}
          change={data.mrrChange}
          icon={DollarSign}
        />
        <MetricCard
          title="Active Clients"
          value={data.activeClients}
          change={data.newClientsThisMonth - data.churnedClientsThisMonth}
          changeLabel="net"
          icon={Users}
        />
        <MetricCard
          title="Churn Rate"
          value={`${data.churnRate}%`}
          change={-2} // negative is good for churn
          invertColors
          icon={TrendingDown}
        />
        <MetricCard
          title="Rev/Client"
          value={`$${data.revenuePerClient}`}
          change={50}
          changeLabel="+$50"
          icon={UserDollar}
        />
        <MetricCard
          title="Avg Compliance"
          value={`${data.avgCompliance}%`}
          change={data.complianceChange}
          icon={Target}
        />
      </div>
      
      {/* Tab Navigation */}
      <Tabs value={activeTab} onValueChange={setActiveTab}>
        <TabsList>
          <TabsTrigger value="revenue">Revenue</TabsTrigger>
          <TabsTrigger value="clients">Clients</TabsTrigger>
          <TabsTrigger value="compliance">Compliance</TabsTrigger>
          <TabsTrigger value="directives">Directives</TabsTrigger>
        </TabsList>
        
        <TabsContent value="revenue">
          <div className="grid grid-cols-2 gap-6">
            <Card>
              <CardHeader>
                <CardTitle>Revenue Over Time</CardTitle>
              </CardHeader>
              <CardContent>
                <RevenueChart data={data.revenueByMonth} />
              </CardContent>
            </Card>
            <Card>
              <CardHeader>
                <CardTitle>Revenue by Source</CardTitle>
              </CardHeader>
              <CardContent>
                <PieChart data={data.revenueBySource} />
              </CardContent>
            </Card>
          </div>
        </TabsContent>
        
        <TabsContent value="clients">
          <div className="grid grid-cols-2 gap-6">
            <Card>
              <CardHeader>
                <CardTitle>Client Growth</CardTitle>
              </CardHeader>
              <CardContent>
                <div className="space-y-4">
                  <div className="flex justify-between">
                    <span>New Clients</span>
                    <span className="text-green-500">+{data.newClientsThisMonth}</span>
                  </div>
                  <div className="flex justify-between">
                    <span>Churned</span>
                    <span className="text-red-500">-{data.churnedClientsThisMonth}</span>
                  </div>
                  <div className="flex justify-between font-semibold">
                    <span>Net</span>
                    <span>{data.newClientsThisMonth - data.churnedClientsThisMonth >= 0 ? '+' : ''}{data.newClientsThisMonth - data.churnedClientsThisMonth}</span>
                  </div>
                </div>
              </CardContent>
            </Card>
            <Card>
              <CardHeader>
                <CardTitle>Retention Cohort</CardTitle>
              </CardHeader>
              <CardContent>
                <RetentionChart data={data.retentionCohort} />
              </CardContent>
            </Card>
            <Card>
              <CardHeader>
                <CardTitle>Top Clients by LTV</CardTitle>
              </CardHeader>
              <CardContent>
                <div className="space-y-2">
                  {data.topClientsByLtv.map((item, index) => (
                    <div key={item.client.id} className="flex justify-between">
                      <span>{index + 1}. {item.client.name}</span>
                      <span>${item.ltv.toLocaleString()}</span>
                    </div>
                  ))}
                </div>
              </CardContent>
            </Card>
            <Card>
              <CardHeader>
                <CardTitle>At Risk (Low Compliance)</CardTitle>
              </CardHeader>
              <CardContent>
                <div className="space-y-2">
                  {data.atRiskClients.map((item) => (
                    <div key={item.client.id} className="flex justify-between">
                      <span>{item.client.name}</span>
                      <Badge variant="destructive">{item.compliance}%</Badge>
                    </div>
                  ))}
                </div>
              </CardContent>
            </Card>
          </div>
        </TabsContent>
        
        <TabsContent value="compliance">
          {/* Compliance charts */}
        </TabsContent>
        
        <TabsContent value="directives">
          {/* Directive analytics */}
        </TabsContent>
      </Tabs>
    </div>
  );
};
```

### FIX BUG: 8357% â†’ 83.57%

The effectiveness percentage is displayed incorrectly. Ensure percentages are formatted correctly:
```typescript
// Wrong: 8357%
// Right: 83.57%

const formatPercentage = (value: number) => {
  return `${value.toFixed(2)}%`;
};
```

---

## TASK 5: Consolidate Organization/Team

### Combine Into Single Section

Remove separate "Team" page. Merge into "Organization" with tabs.

### Updated Organization Page

```tsx
// pages/organization.tsx

const Organization = () => {
  const [activeTab, setActiveTab] = useState('overview');
  
  // Hide entire section for solo mentors with no organization
  if (!organization) {
    return null; // Or redirect to settings to create org
  }
  
  return (
    <div className="space-y-6">
      <div className="flex justify-between items-center">
        <div>
          <h1>{organization.name}</h1>
          <Badge>{organization.type}</Badge>
        </div>
        <Button variant="outline">
          <Settings className="w-4 h-4 mr-2" />
          Settings
        </Button>
      </div>
      
      <Tabs value={activeTab} onValueChange={setActiveTab}>
        <TabsList>
          <TabsTrigger value="overview">Overview</TabsTrigger>
          <TabsTrigger value="team">Team</TabsTrigger>
          <TabsTrigger value="clients">All Clients</TabsTrigger>
          <TabsTrigger value="reports">Reports</TabsTrigger>
        </TabsList>
        
        <TabsContent value="overview">
          {/* Organization stats */}
          <div className="grid grid-cols-4 gap-4">
            <MetricCard title="Mentors" value={organization.mentorCount} icon={Users} />
            <MetricCard title="Total Clients" value={organization.clientCount} icon={UserCheck} />
            <MetricCard title="Sessions/Month" value={organization.sessionsPerMonth} icon={Calendar} />
            <MetricCard title="Revenue" value={`$${organization.revenue}`} icon={DollarSign} />
          </div>
          
          {/* Mentor Performance Table */}
          <Card className="mt-6">
            <CardHeader>
              <CardTitle>Mentor Performance</CardTitle>
            </CardHeader>
            <CardContent>
              <Table>
                <TableHeader>
                  <TableRow>
                    <TableHead>Mentor</TableHead>
                    <TableHead>Clients</TableHead>
                    <TableHead>Sessions</TableHead>
                    <TableHead>Compliance</TableHead>
                    <TableHead>Revenue</TableHead>
                    <TableHead></TableHead>
                  </TableRow>
                </TableHeader>
                <TableBody>
                  {mentors.map(mentor => (
                    <TableRow key={mentor.id}>
                      <TableCell>{mentor.name}</TableCell>
                      <TableCell>{mentor.clientCount}</TableCell>
                      <TableCell>{mentor.sessionCount}</TableCell>
                      <TableCell>{mentor.avgCompliance}%</TableCell>
                      <TableCell>${mentor.revenue}</TableCell>
                      <TableCell>
                        <Button variant="ghost" size="sm">View</Button>
                      </TableCell>
                    </TableRow>
                  ))}
                </TableBody>
              </Table>
            </CardContent>
          </Card>
        </TabsContent>
        
        <TabsContent value="team">
          {/* Team management - moved from separate Team page */}
          <div className="flex justify-between items-center mb-4">
            <h2>Team Members</h2>
            <Button>
              <Plus className="w-4 h-4 mr-2" />
              Invite Mentor
            </Button>
          </div>
          
          <div className="space-y-4">
            {mentors.map(mentor => (
              <MentorCard key={mentor.id} mentor={mentor} />
            ))}
          </div>
        </TabsContent>
        
        <TabsContent value="clients">
          {/* All clients across all mentors */}
          <div className="mb-4">
            <Select>
              <SelectItem value="all">All Mentors</SelectItem>
              {mentors.map(m => (
                <SelectItem key={m.id} value={m.id}>{m.name}</SelectItem>
              ))}
            </Select>
          </div>
          
          <ClientsTable clients={allClients} showMentorColumn />
        </TabsContent>
        
        <TabsContent value="reports">
          {/* Organization-level reports */}
        </TabsContent>
      </Tabs>
    </div>
  );
};
```

### Sidebar Update

Remove separate "Team" link. Keep "Organization" but only show for users who have an organization:

```tsx
// In app-sidebar.tsx

// Only show Organization for users with orgs
{user.organizationId && (
  <SidebarMenuItem>
    <SidebarMenuButton asChild>
      <Link to="/organization">
        <Building className="w-4 h-4" />
        <span>Organization</span>
      </Link>
    </SidebarMenuButton>
  </SidebarMenuItem>
)}
```

---

## Build Order

1. **Dashboard Redesign**
   - Create new components (priority-card, needs-attention, activity-feed, business-snapshot)
   - Update dashboard.tsx
   - Add mock data
   - Update clients.tsx to differentiate

2. **Program Templates**
   - Add types
   - Create pages (list, builder)
   - Create components
   - Add mock data
   - Add routes
   - Update sidebar

3. **Calendar Availability**
   - Add types
   - Create availability modal
   - Update calendar.tsx
   - Add mock data

4. **Analytics Fix**
   - Fix percentage bug
   - Add new metrics
   - Create tabbed interface
   - Add charts

5. **Consolidate Org/Team**
   - Merge team into organization
   - Add tabs
   - Update sidebar
   - Hide for solo mentors

---

## REMINDER: Build Summary

**When complete, create `BUILD_SUMMARY.md` with:**
1. Files Created (path + purpose)
2. Files Modified (path + what changed)
3. Components Built
4. Routes Added
5. Types Added
6. Mock Data Added
7. Features Implemented (plain English)
8. Known Issues
9. Screenshots of each major screen

Save this file in the project root.